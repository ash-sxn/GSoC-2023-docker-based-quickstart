name: Docker Compose Test

on:
  push:
    branches:
      - '*'

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up and start Docker Compose
        uses: isbang/compose-action@v1.4.1
        with:
          compose-file: "./04_sidekick/docker-compose.yaml"
          down-flags: "--volumes"
          up-flags: "--build --remove-orphans --force-recreate -d"


      - name: Wait for services to be ready
        run: |
          # Add a script here to wait for your services to be ready
          # For example, you can use the `curl` command to check if the services are up and running
          curl http://localhost:8080  # Adjust the URL based on your specific test case
      - name: Run curl command to test the stack
        run: |
          curl http://localhost:8080  # Adjust the URL based on your specific test case

      - name: Stop and remove Docker Compose services
        uses: isbang/compose-action@v1.4.1
        with:
          compose-file: "./04_sidekick/docker-compose.yml"
          down-flags: "--volumes"